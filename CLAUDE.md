# CLAUDE.md

å¦‚æœå†™æ–‡æ¡£æ²¡æœ‰ç‰¹æ®Šè¯´æ˜,éƒ½ä»¥md æ ¼å¼æ”¾åˆ°,notes ç›®å½•

è¿™æ˜¯ä¸€ä¸ª uv æ¡†æ¶çš„ python é¡¹ç›®
è¿è¡Œä»£ç è¦ç”¨  uv run xxx.py
å®‰è£…åŒ…è¦ç”¨ uv add åŒ…å

## æ ¸å¿ƒè®¾è®¡åŸåˆ™

### 1. è‡ªç ”æ¡†æ¶ - å®Œå…¨æ§åˆ¶
- **ä¸ä½¿ç”¨ LangGraph**ï¼šæŠ›å¼ƒå¤–éƒ¨æ¡†æ¶æŸç¼šï¼Œå®Œå…¨è‡ªä¸»æ§åˆ¶æ‰§è¡Œæµç¨‹
- **å¼‚æ­¥å¹¶å‘ä¼˜å…ˆ**ï¼šä½¿ç”¨ asyncio å®ç°å¹¶å‘æ„ŸçŸ¥ã€åå°è§‚å¯Ÿç­‰æ ¸å¿ƒç‰¹æ€§
- **æ€§èƒ½ä¼˜åŠ¿**ï¼šå¹¶å‘æ„ŸçŸ¥é€Ÿåº¦æå‡ 3 å€ï¼ˆ0.5s vs 1.5sï¼‰
- **ä»£ç ç®€æ´**ï¼šå³æ—¶åé¦ˆ 1 ä¸ªå‡½æ•°æå®šï¼ˆvs LangGraph 5 ä¸ªèŠ‚ç‚¹ï¼‰

### 2. åŒå±‚ Agent æ¶æ„
- **Master Agentï¼ˆä»»åŠ¡ç®¡ç†å±‚ï¼‰**ï¼š
  - ä»»åŠ¡åˆ†è§£ä¸è°ƒåº¦
  - Worker æ‰§è¡Œç›‘ç£
  - å¼‚å¸¸æ£€æµ‹ä¸æ¢å¤
  - å¾ªç¯ä»»åŠ¡ç®¡ç†

- **Worker Agentï¼ˆè®¤çŸ¥æ‰§è¡Œå±‚ï¼‰**ï¼š
  - è§‚å¯Ÿå±å¹•ï¼ˆå¹¶å‘æ„ŸçŸ¥ï¼‰
  - å†³ç­–æ“ä½œï¼ˆCoT + å…ƒè®¤çŸ¥ï¼‰
  - æ‰§è¡ŒåŠ¨ä½œï¼ˆå³æ—¶åé¦ˆï¼‰
  - è®°å¿†ç®¡ç†

### 3. äººç±»è®¤çŸ¥æ¨¡æ‹Ÿ
- **è§‚å¯Ÿ â†’ æ€è€ƒ â†’ å†³ç­– â†’ æ‰§è¡Œ â†’ åé¦ˆ** å®Œæ•´å¾ªç¯
- **å·¥ä½œè®°å¿†**ï¼š7Â±2 å®¹é‡ï¼Œå¾ªç¯æ£€æµ‹ï¼Œæ—¶é—´è¡°å‡
- **é•¿æœŸè®°å¿†**ï¼šç»éªŒç§¯ç´¯ï¼Œå‘é‡æ£€ç´¢ï¼Œé¦–æ¬¡æ¢ç´¢åç»­ç›´è¾¾
- **æŒç»­è§‚å¯Ÿ**ï¼šåå° 0.5 ç§’é—´éš”ç›‘æ§ï¼Œè‡ªåŠ¨å¤„ç†å¼¹çª—/åŠ è½½/é”™è¯¯
- **è¯•é”™çº é”™**ï¼šæ‰§è¡Œå 0.5 ç§’å³æ—¶åˆ¤æ–­ï¼Œé”™è¯¯ç«‹å³å›é€€

## é¡¹ç›®ç›®å½•ç»“æ„

```
droidrun-vl/
â”‚
â”œâ”€â”€ src/                          # æ ¸å¿ƒæºä»£ç 
â”‚   â”œâ”€â”€ core/                     # æ ¸å¿ƒç­–ç•¥æ ‘å¼•æ“
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ strategy_node.py      # ç»Ÿä¸€ç­–ç•¥èŠ‚ç‚¹ (æ ¸å¿ƒ)
â”‚   â”‚   â”œâ”€â”€ strategy_tree.py      # ç­–ç•¥æ ‘æ‰§è¡Œå™¨
â”‚   â”‚   â””â”€â”€ state.py              # çŠ¶æ€ç®¡ç†
â”‚   â”‚
â”‚   â”œâ”€â”€ perception/               # æ„ŸçŸ¥ç³»ç»Ÿ (å¹¶å‘ + å¤šæ¨¡æ€)
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ vision_analyzer.py    # VL æ¨¡å‹è§†è§‰åˆ†æ
â”‚   â”‚   â”œâ”€â”€ ui_detector.py        # UI å…ƒç´ æ£€æµ‹
â”‚   â”‚   â”œâ”€â”€ ocr_extractor.py      # OCR æ–‡æœ¬æå–
â”‚   â”‚   â”œâ”€â”€ multimodal_fusion.py  # å¤šæ¨¡æ€èåˆ (AgenticRAG)
â”‚   â”‚   â””â”€â”€ screen_observer.py    # æŒç»­è§‚å¯Ÿ (åå°ä»»åŠ¡)
â”‚   â”‚
â”‚   â”œâ”€â”€ decision/                 # å†³ç­–ç³»ç»Ÿ (CoT + åæ€)
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ decision_maker.py     # æ ¸å¿ƒå†³ç­–å™¨ (CoT + äº¤é”™æ£€ç´¢)
â”‚   â”‚   â”œâ”€â”€ branching.py          # åˆ†æ”¯ç”Ÿæˆå™¨
â”‚   â”‚   â”œâ”€â”€ reflection.py         # åæ€ç”Ÿæˆå™¨ (Reflexion)
â”‚   â”‚   â””â”€â”€ risk_evaluator.py     # é£é™©è¯„ä¼°
â”‚   â”‚
â”‚   â”œâ”€â”€ execution/                # æ‰§è¡Œç³»ç»Ÿ
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ action_executor.py    # åŠ¨ä½œæ‰§è¡Œå™¨
â”‚   â”‚   â”œâ”€â”€ feedback_controller.py # å³æ—¶åé¦ˆæ§åˆ¶å™¨
â”‚   â”‚   â”œâ”€â”€ screen_comparator.py  # å‰åå±å¹•å¯¹æ¯” (MobileAgent)
â”‚   â”‚   â”œâ”€â”€ error_threshold.py    # é”™è¯¯é˜ˆå€¼æ§åˆ¶å™¨ (MobileAgent)
â”‚   â”‚   â””â”€â”€ corrective.py         # è‡ªæˆ‘çº é”™ (AgenticRAG)
â”‚   â”‚
â”‚   â”œâ”€â”€ memory/                   # è®°å¿†ç³»ç»Ÿ (å¤šå±‚ + åæ€)
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ working_memory.py     # å·¥ä½œè®°å¿† (7Â±2 + å¾ªç¯æ£€æµ‹)
â”‚   â”‚   â”œâ”€â”€ reflection_memory.py  # åæ€è®°å¿† (æ»‘åŠ¨çª—å£)
â”‚   â”‚   â”œâ”€â”€ adaptive_retriever.py # è‡ªé€‚åº”æ£€ç´¢å™¨ (AgenticRAG)
â”‚   â”‚   â”œâ”€â”€ vector_store.py       # å‘é‡å­˜å‚¨å°è£…
â”‚   â”‚   â”œâ”€â”€ experience_store.py   # ç»éªŒå­˜å‚¨ (ä»…æˆåŠŸ + åˆ†å±‚)
â”‚   â”‚   â””â”€â”€ spatial_memory.py     # ç©ºé—´è®°å¿† (é¡µé¢å¯¼èˆªå›¾)
â”‚   â”‚
â”‚   â”œâ”€â”€ device/                   # è®¾å¤‡äº¤äº’å±‚
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ android_controller.py # Android æ§åˆ¶å™¨
â”‚   â”‚   â”œâ”€â”€ adb_tools.py          # ADB å·¥å…·å°è£…
â”‚   â”‚   â””â”€â”€ screen_capture.py     # æˆªå±å·¥å…·
â”‚   â”‚
â”‚   â”œâ”€â”€ models/                   # æ•°æ®æ¨¡å‹ (Pydantic)
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ task.py               # ä»»åŠ¡æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ action.py             # åŠ¨ä½œæ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ perception.py         # æ„ŸçŸ¥ç»“æœæ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ decision.py           # å†³ç­–æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ strategy.py           # ç­–ç•¥èŠ‚ç‚¹æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ experience.py         # ç»éªŒæ¨¡å‹
â”‚   â”‚   â””â”€â”€ reflection.py         # åæ€æ¨¡å‹
â”‚   â”‚
â”‚   â”œâ”€â”€ llm/                      # LLM é›†æˆ
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ client.py             # LLM å®¢æˆ·ç«¯ (ç»Ÿä¸€æ¥å£)
â”‚   â”‚   â”œâ”€â”€ prompts/              # Prompt æ¨¡æ¿
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ perception_prompts.py
â”‚   â”‚   â”‚   â”œâ”€â”€ decision_prompts.py
â”‚   â”‚   â”‚   â”œâ”€â”€ reflection_prompts.py  # åæ€ Prompt
â”‚   â”‚   â”‚   â””â”€â”€ retrieval_prompts.py   # æ£€ç´¢ Prompt
â”‚   â”‚   â””â”€â”€ parsers.py            # è¾“å‡ºè§£æå™¨
â”‚   â”‚
â”‚   â”œâ”€â”€ utils/                    # å·¥å…·å‡½æ•°
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ config.py             # é…ç½®ç®¡ç† âœ…
â”‚   â”‚   â”œâ”€â”€ logger.py             # æ—¥å¿—ç³»ç»Ÿ
â”‚   â”‚   â”œâ”€â”€ metrics.py            # æ€§èƒ½æŒ‡æ ‡
â”‚   â”‚   â”œâ”€â”€ visualizer.py         # æ‰§è¡Œå¯è§†åŒ– (Mermaid)
â”‚   â”‚   â””â”€â”€ helpers.py            # è¾…åŠ©å‡½æ•°
â”‚   â”‚
â”‚   â””â”€â”€ main.py                   # ç¨‹åºå…¥å£
â”‚
â”œâ”€â”€ data/                         # æ•°æ®å­˜å‚¨
â”‚   â”œâ”€â”€ experiences/              # ç»éªŒåº“
â”‚   â”‚   â”œâ”€â”€ vector_db/            # å‘é‡æ•°æ®åº“ (LanceDB) âœ…
â”‚   â”‚   â”‚   â”œâ”€â”€ atomic/           # Level 1: åŸå­æ“ä½œçº§
â”‚   â”‚   â”‚   â”œâ”€â”€ task/             # Level 2: ä»»åŠ¡åºåˆ—çº§
â”‚   â”‚   â”‚   â””â”€â”€ strategy/         # Level 3: ç­–ç•¥çº§
â”‚   â”‚   â””â”€â”€ reflections.jsonl     # åæ€è®°å½•
â”‚   â”œâ”€â”€ spatial_maps/             # ç©ºé—´è®°å¿†
â”‚   â”œâ”€â”€ screenshots/              # è¿è¡Œæ—¶æˆªå›¾
â”‚   â”‚   â”œâ”€â”€ before/               # æ‰§è¡Œå‰æˆªå›¾
â”‚   â”‚   â””â”€â”€ after/                # æ‰§è¡Œåæˆªå›¾
â”‚   â””â”€â”€ logs/                     # æ‰§è¡Œæ—¥å¿—
â”‚
â”œâ”€â”€ configs/                      # é…ç½®æ–‡ä»¶
â”‚   â””â”€â”€ config.yaml               # ç»Ÿä¸€é…ç½®æ–‡ä»¶ âœ…
â”‚
â”œâ”€â”€ examples/                     # ç¤ºä¾‹ä»£ç 
â”‚   â”œâ”€â”€ simple_task.py            # ç®€å•ä»»åŠ¡ç¤ºä¾‹
â”‚   â”œâ”€â”€ complex_task.py           # å¤æ‚ä»»åŠ¡ç¤ºä¾‹
â”‚   â”œâ”€â”€ reflection_demo.py        # åæ€å­¦ä¹ æ¼”ç¤º
â”‚   â””â”€â”€ retrieval_demo.py         # æ£€ç´¢ä¼˜åŒ–æ¼”ç¤º
â”‚
â”œâ”€â”€ tests/                        # æµ‹è¯•ç›®å½•
â”‚   â”œâ”€â”€ unit/                     # å•å…ƒæµ‹è¯•
â”‚   â”‚   â”œâ”€â”€ test_strategy_node.py
â”‚   â”‚   â”œâ”€â”€ test_reflection.py
â”‚   â”‚   â”œâ”€â”€ test_adaptive_retriever.py
â”‚   â”‚   â”œâ”€â”€ test_screen_comparator.py
â”‚   â”‚   â””â”€â”€ test_error_threshold.py
â”‚   â”œâ”€â”€ integration/              # é›†æˆæµ‹è¯•
â”‚   â”‚   â”œâ”€â”€ test_strategy_tree.py
â”‚   â”‚   â””â”€â”€ test_end_to_end.py
â”‚   â””â”€â”€ fixtures/                 # æµ‹è¯•æ•°æ®
â”‚       â”œâ”€â”€ screenshots/
â”‚       â””â”€â”€ mock_experiences.json
â”‚
â”œâ”€â”€ notes/                        # è®¾è®¡æ–‡æ¡£
â”‚   â”œâ”€â”€ é¡¶å±‚æ¶æ„è®¾è®¡3_ç»éªŒ.md      # æœ¬æ–‡æ¡£çš„ç†è®ºåŸºç¡€
â”‚   â”œâ”€â”€ é¡¹ç›®å·¥ç¨‹ä»£ç ç»“æ„è§„åˆ’2.md   # å‰ä»£æ¶æ„
â”‚   â””â”€â”€ é¡¹ç›®å·¥ç¨‹ä»£ç ç»“æ„è§„åˆ’3.md   # æœ¬æ–‡æ¡£ (å½“å‰)
â”‚
â”œâ”€â”€ pyproject.toml                # é¡¹ç›®é…ç½®
â”œâ”€â”€ uv.lock                       # ä¾èµ–é”å®š
â”œâ”€â”€ README.md
â””â”€â”€ CLAUDE.md                     # Claude æŒ‡ä»¤
```

## æ¨¡å‹é…ç½®

### Embedding æ¨¡å‹
- API Base: `http://192.168.18.9:8081/v1`
- Model: `/models`
- ç”¨é€”: æ–‡æœ¬å‘é‡åŒ–ï¼Œç”¨äºç»éªŒæ£€ç´¢

### Qwen3-VL è§†è§‰è¯­è¨€æ¨¡å‹
- API Base: `http://192.168.18.9:8080/v1`
- Model: `/models`
- ç”¨é€”: å±å¹•ç†è§£ã€å†³ç­–ç”Ÿæˆã€ä»»åŠ¡è§„åˆ’

### å‘é‡æ•°æ®åº“
- ç±»å‹: LanceDB
- è·¯å¾„: `data/experiences/vector_db/`
- ç”¨é€”: é•¿æœŸè®°å¿†å­˜å‚¨ï¼Œç»éªŒæ£€ç´¢

## å¼€å‘çŠ¶æ€

### å·²å®Œæˆ âœ…
- [x] é¡¹ç›®ç›®å½•ç»“æ„
- [x] é…ç½®ç®¡ç†æ¨¡å—ï¼ˆ`src/utils/config.py`ï¼‰
- [x] LLM å®¢æˆ·ç«¯å°è£…ï¼ˆ`src/llm/client.py`ï¼‰
- [x] å‘é‡å­˜å‚¨å°è£…ï¼ˆ`src/memory/vector_store.py`ï¼‰
- [x] åŸºç¡€æ•°æ®æ¨¡å‹ï¼ˆ`src/models/*.py`ï¼‰
  - Action åŠ¨ä½œæ¨¡å‹
  - Task ä»»åŠ¡æ¨¡å‹
  - Perception æ„ŸçŸ¥æ¨¡å‹
- [x] è®¾å¤‡äº¤äº’å±‚ï¼ˆ`src/device/`ï¼‰
  - AndroidController å¼‚æ­¥è®¾å¤‡æ§åˆ¶å™¨
  - ExecutionResult ç»Ÿä¸€è¿”å›æ ¼å¼
  - å®Œæ•´çš„è®¾å¤‡æ“ä½œèƒ½åŠ›ï¼ˆtap/swipe/input/screenshot/ui_tree ç­‰ï¼‰

### è¿›è¡Œä¸­ ğŸš§
- [ ] Master Agent æ ¸å¿ƒå®ç°
- [ ] Worker Agent è®¤çŸ¥å¾ªç¯
- [ ] æ„ŸçŸ¥ç³»ç»Ÿï¼ˆå¹¶å‘ï¼‰
- [ ] å†³ç­–ç³»ç»Ÿï¼ˆCoT + å…ƒè®¤çŸ¥ï¼‰
- [ ] æ‰§è¡Œç³»ç»Ÿï¼ˆå³æ—¶åé¦ˆï¼‰

## å¿«é€Ÿå¼€å§‹

### å®‰è£…ä¾èµ–
```bash
uv add openai pydantic lancedb pyyaml loguru adbutils requests
```

### æµ‹è¯•åŸºç¡€è®¾ç½®
```bash
# æµ‹è¯•é…ç½®ç®¡ç†
uv run src/utils/config.py

# æµ‹è¯• LLM å®¢æˆ·ç«¯
uv run src/llm/client.py

# æµ‹è¯•å‘é‡å­˜å‚¨
uv run src/memory/vector_store.py

# æµ‹è¯•è®¾å¤‡æ§åˆ¶å™¨ï¼ˆéœ€è¦è¿æ¥è®¾å¤‡ï¼‰
uv run test_device.py

# å®Œæ•´åŸºç¡€æµ‹è¯•
uv run test_basic_setup.py
```

