# MobileAgent é¡¹ç›®ç»éªŒæ€»ç»“

## é¡¹ç›®æ¦‚è¿°

MobileAgent æ˜¯é˜¿é‡Œå·´å·´é€šä¹‰å®éªŒå®¤ï¼ˆX-PLUGï¼‰å¼€å‘çš„ GUI è‡ªåŠ¨åŒ–æ¡†æ¶ï¼Œç»å†äº†ä¸‰ä¸ªä¸»è¦ç‰ˆæœ¬çš„æ¼”è¿›ï¼š
- **Mobile-Agent-v1**: å• Agent æ¶æ„ï¼ŒåŸºç¡€åŠŸèƒ½å®ç°
- **Mobile-Agent-v2**: å¤š Agent åä½œæ¶æ„ï¼Œ30%+ ä»»åŠ¡å®Œæˆç‡æå‡ï¼ˆNeurIPS 2024ï¼‰
- **Mobile-Agent-v3**: åŸºäº GUI-Owl çš„ç«¯åˆ°ç«¯æ¨¡å‹ + å¤š Agent æ¡†æ¶ï¼ŒSOTA æ€§èƒ½

## 1. æ•´ä½“æ¶æ„è®¾è®¡

### 1.1 Mobile-Agent-v2 æ¶æ„ï¼ˆå¤š Agent åä½œï¼‰

**æ ¸å¿ƒåˆ›æ–°ï¼šä¸‰ Agent åˆ†å·¥åä½œ**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Planning Agent â”‚  â† å†å²æ“ä½œæµ“ç¼© â†’ çº¯æ–‡æœ¬ä»»åŠ¡è¿›åº¦
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Decision Agent  â”‚  â† å½“å‰å±å¹• + ä»»åŠ¡è¿›åº¦ + åæ€ â†’ æ‰§è¡ŒåŠ¨ä½œ
â”‚  + Memory Unit  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Reflection Agentâ”‚  â† å‰åå±å¹•å¯¹æ¯” â†’ åˆ¤æ–­æ“ä½œæ­£è¯¯
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ä¸‰ä¸ªæ ¸å¿ƒ Agentï¼š**

1. **Planning Agentï¼ˆè§„åˆ’ä»£ç†ï¼‰**
   - èŒè´£ï¼šå°†å†—é•¿çš„å›¾æ–‡äº¤ç»‡å†å²æ“ä½œ + å±å¹•æ‘˜è¦ï¼Œæµ“ç¼©ä¸ºçº¯æ–‡æœ¬ä»»åŠ¡è¿›åº¦
   - è¾“å‡ºï¼šä¼ é€’ç»™ Decision Agent çš„ä»»åŠ¡è¿›åº¦æ–‡æœ¬
   - è§£å†³é—®é¢˜ï¼šé¿å… Decision Agent å¤„ç†è¿‡é•¿ token åºåˆ—

2. **Decision Agentï¼ˆå†³ç­–ä»£ç†ï¼‰**
   - èŒè´£ï¼šåŸºäºå½“å‰ä»»åŠ¡è¿›åº¦ã€å½“å‰å±å¹•çŠ¶æ€ã€åæ€ï¼ˆå¦‚æœ‰é”™è¯¯ï¼‰ç”Ÿæˆæ“ä½œ
   - é…å¤‡ Memory Unitï¼šéšä»»åŠ¡è¿›åº¦åŠ¨æ€æ›´æ–°ï¼Œä¿ç•™å…³æ³¨å†…å®¹
   - ä¼˜åŠ¿ï¼šå‡å°‘ä¸Šä¸‹æ–‡é•¿åº¦ï¼Œæ›´å®¹æ˜“å¯¼èˆªä»»åŠ¡è¿›åº¦

3. **Reflection Agentï¼ˆåæ€ä»£ç†ï¼‰**
   - èŒè´£ï¼šè§‚å¯Ÿæ¯æ¬¡æ“ä½œçš„ç»“æœï¼Œå¤„ç†é”™è¯¯
   - æœºåˆ¶ï¼šå¯¹æ¯”æ“ä½œå‰åå±å¹•ï¼Œåˆ¤æ–­æ“ä½œæ˜¯å¦ç¬¦åˆé¢„æœŸ
   - ä¸‰ç§æ“ä½œåˆ†ç±»ï¼š
     - Erroneousï¼ˆé”™è¯¯æ“ä½œï¼‰
     - Ineffectiveï¼ˆæ— æ•ˆæ“ä½œï¼‰
     - Correctï¼ˆæ­£ç¡®æ“ä½œï¼‰

**å…³é”®è®¾è®¡ç†å¿µï¼š**
- è§£å†³é•¿ä¸Šä¸‹æ–‡é—®é¢˜ï¼šPlanning Agent æµ“ç¼©å†å²ï¼Œå‡å°‘ Decision Agent è´Ÿæ‹…
- ä¸Šä¸‹æ–‡å¯¼èˆªä¼˜åŒ–ï¼šçº¯æ–‡æœ¬ä»»åŠ¡è¿›åº¦æ¯”å›¾æ–‡äº¤ç»‡æ›´æ˜“å¤„ç†
- åŠ¨æ€è®°å¿†ç®¡ç†ï¼šMemory Unit æ ¹æ®ä»»åŠ¡è¿›åº¦æ›´æ–°
- é”™è¯¯æ£€æµ‹ä¸æ¢å¤ï¼šReflection Agent æä¾›å³æ—¶åé¦ˆ

**æ€§èƒ½æå‡ï¼š**
- ä»»åŠ¡å®Œæˆç‡æå‡ 30%+ï¼ˆç›¸æ¯” v1 å• Agent æ¶æ„ï¼‰
- åœ¨å¤æ‚å¤šæ­¥éª¤ä»»åŠ¡ä¸­è¡¨ç°ä¼˜å¼‚
- æ”¯æŒè·¨è¯­è¨€ç¯å¢ƒ

### 1.2 Mobile-Agent-v3 æ¶æ„ï¼ˆç«¯åˆ°ç«¯æ¨¡å‹ + å¤š Agentï¼‰

**åŒå±‚æ¶æ„ï¼šGUI-Owl åŸºç¡€æ¨¡å‹ + å¤š Agent æ¡†æ¶**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Mobile-Agent-v3 Framework            â”‚
â”‚                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ Manager â”‚â†’ â”‚ Worker â”‚â†’ â”‚Reflector â”‚â†’ â”‚ Note â”‚â”‚
â”‚  â”‚  Agent  â”‚  â”‚ Agent  â”‚  â”‚  Agent   â”‚  â”‚taker â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”¬â”€â”€â”€â”˜â”‚
â”‚       â”‚           â”‚            â”‚           â”‚    â”‚
â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                      â†“                          â”‚
â”‚            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚            â”‚  GUI-Owl Model   â”‚                 â”‚
â”‚            â”‚ (End-to-End VLM) â”‚                 â”‚
â”‚            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚                      â†“                          â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚         â”‚   Device Interface     â”‚              â”‚
â”‚         â”‚ (Android/PC/MacOS/Win) â”‚              â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å…­å¤§æ¨¡å—ï¼š**

1. **RAG æ¨¡å—**
   - æ£€ç´¢å¤–éƒ¨ä¸–ç•ŒçŸ¥è¯†
   - ä¸º Manager Agent æä¾›è§„åˆ’å‚è€ƒ

2. **Manager Agentï¼ˆç®¡ç†ä»£ç†ï¼‰â„³**
   - æˆ˜ç•¥è§„åˆ’è€…
   - å°†é«˜å±‚æŒ‡ä»¤åˆ†è§£ä¸ºæœ‰åºå­ç›®æ ‡åˆ—è¡¨
   - ä½¿ç”¨å¤–éƒ¨çŸ¥è¯†æ£€ç´¢ï¼ˆRAGï¼‰
   - æ ¹æ®æ‰§è¡Œç»“æœå’Œåé¦ˆåŠ¨æ€æ›´æ–°è®¡åˆ’

3. **Worker Agentï¼ˆå·¥ä½œä»£ç†ï¼‰ğ’²**
   - æˆ˜æœ¯æ‰§è¡Œè€…
   - æ ¹æ®å½“å‰ GUI çŠ¶æ€ã€å…ˆå‰åé¦ˆã€ç´¯ç§¯ç¬”è®°é€‰æ‹©æœ€ç›¸å…³çš„å­ç›®æ ‡
   - è¾“å‡ºåŠ¨ä½œå…ƒç»„ï¼šæ¨ç† + åŠ¨ä½œ + æ„å›¾

4. **Reflector Agentï¼ˆåæ€ä»£ç†ï¼‰â„›**
   - è‡ªæˆ‘çº æ­£æœºåˆ¶
   - å¯¹æ¯”é¢„æœŸç»“æœä¸å®é™…çŠ¶æ€è½¬æ¢
   - åˆ†ç±»ç»“æœä¸º SUCCESS æˆ– FAILURE
   - ä¸º Manager Agent ç”Ÿæˆå› æœåé¦ˆ

5. **Notetaker Agentï¼ˆè®°å½•ä»£ç†ï¼‰ğ’**
   - æŒä¹…åŒ–ä¸Šä¸‹æ–‡è®°å¿†
   - ä»…åœ¨ SUCCESS æ—¶è§¦å‘
   - æå–å’Œå­˜å‚¨å…³é”®å±å¹•å…ƒç´ ï¼ˆå¦‚ä»£ç ã€å‡­è¯ï¼‰
   - æ”¯æŒåç»­è§„åˆ’å’Œæ‰§è¡Œ

6. **GUI è®¾å¤‡æ¥å£**
   - æ”¯æŒæ‰‹æœºå’Œ PC ç¯å¢ƒ
   - è·¨å¹³å°æ“ä½œ

**æ‰§è¡Œæµç¨‹ï¼š**

```
Manager åˆ†è§£ä»»åŠ¡ â†’ Worker æ‰§è¡Œå­ç›®æ ‡ â†’ Reflector è¯„ä¼°ç»“æœ
     â†‘                                         â†“
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ åé¦ˆ & æ›´æ–°è®¡åˆ’ â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â†“ (SUCCESS)
                 Notetaker è®°å½•å…³é”®ä¿¡æ¯
```

**å…³é”®åˆ›æ–°ç‚¹ï¼š**

1. **åŠ¨æ€ä»»åŠ¡åˆ†è§£**ï¼šManager æ ¹æ®æ‰§è¡Œç»“æœå®æ—¶è°ƒæ•´è®¡åˆ’
2. **æŒä¹…åŒ–è®°å¿†**ï¼šNotetaker ä¿å­˜è·¨åº”ç”¨çš„å…³é”®ä¿¡æ¯
3. **è‡ªæˆ‘çº æ­£**ï¼šReflector æä¾›è¯¦ç»†çš„å› æœåé¦ˆ
4. **å¤š Agent åä½œ**ï¼š4 ä¸ªä¸“ä¸š Agent å„å¸å…¶èŒ

**æ€§èƒ½è¡¨ç°ï¼š**
- AndroidWorld: 62.1% æˆåŠŸç‡
- OSWorld-Verified: 48.4% æˆåŠŸç‡
- è¶…è¶Šæ‰€æœ‰åŸºå‡†æ¨¡å‹

### 1.3 GUI-Owl åŸºç¡€æ¨¡å‹

**ç«¯åˆ°ç«¯ç»Ÿä¸€ç­–ç•¥ç½‘ç»œ**

GUI-Owl æ˜¯ä¸“ä¸º GUI è‡ªåŠ¨åŒ–è®¾è®¡çš„åŸç”Ÿç«¯åˆ°ç«¯å¤šæ¨¡æ€ Agent æ¨¡å‹ï¼Œç»Ÿä¸€äº†æ„ŸçŸ¥ã€å®šä½ã€æ¨ç†ã€è§„åˆ’å’ŒåŠ¨ä½œæ‰§è¡Œã€‚

**æ ¸å¿ƒç‰¹æ€§ï¼š**

1. **ç»Ÿä¸€ç­–ç•¥ç½‘ç»œ**
   - åŸºäº Qwen2.5-VL è¡ç”Ÿæ¨¡å‹
   - ä½¿ç”¨å¤§è§„æ¨¡ GUI äº¤äº’è¯­æ–™åè®­ç»ƒ
   - é›†æˆ UI å®šä½ã€è§„åˆ’ã€åŠ¨ä½œè¯­ä¹‰ã€æ¨ç†æ¨¡å¼

2. **å¤§è§„æ¨¡ç¯å¢ƒåŸºç¡€è®¾æ–½**
   - äº‘ç«¯è™šæ‹Ÿç¯å¢ƒï¼šAndroidã€Ubuntuã€macOSã€Windows
   - æ”¯æŒè‡ªæ¼”åŒ– GUI è½¨è¿¹ç”Ÿæˆæ¡†æ¶

3. **å¼ºåŒ–å­¦ä¹ æ¡†æ¶**
   - å…¨å¼‚æ­¥è®­ç»ƒï¼Œå®ç°çœŸå®ä¸–ç•Œå¯¹é½
   - Trajectory-aware Relative Policy Optimization (TRPO)
   - OSWorld å¾—åˆ† 34.9

**æ€§èƒ½ï¼š**
- GUI-Owl-7B å•ç‹¬ï¼šAndroidWorld 66.4ï¼ŒOSWorld 29.4
- Mobile-Agent-v3ï¼ˆå¤š Agentï¼‰ï¼šAndroidWorld 73.3ï¼ŒOSWorld 37.7

**è®¾è®¡ç†å¿µï¼š**
- æ—¢å¯ä½œä¸ºç«¯åˆ°ç«¯æ¨¡å‹å•ç‹¬ä½¿ç”¨
- ä¹Ÿå¯ä½œä¸ºå¤š Agent ç³»ç»Ÿçš„æ¨¡å—åŒ–ç»„ä»¶

## 2. è§†è§‰ç†è§£

### 2.1 è§†è§‰æ„ŸçŸ¥å·¥å…·é“¾ï¼ˆv2ï¼‰

**ä¸‰å¤§å·¥å…·ååŒï¼š**

1. **Text Recognitionï¼ˆæ–‡æœ¬è¯†åˆ«ï¼‰**
   - ä½¿ç”¨ OCR æ£€æµ‹å’Œè¯†åˆ«
   - æå–æ–‡æœ¬å†…å®¹ + åæ ‡ä½ç½®
   - ModelScope æµæ°´çº¿

2. **Icon Recognitionï¼ˆå›¾æ ‡è¯†åˆ«ï¼‰**
   - å®šä½å±å¹•ä¸Šçš„å›¾æ ‡å…ƒç´ 
   - è¿”å›å›¾æ ‡ä½ç½®åæ ‡

3. **Icon Descriptionï¼ˆå›¾æ ‡æè¿°ï¼‰**
   - ä½¿ç”¨ Qwen-VL è¿›è¡Œå›¾åƒæè¿°
   - ç”Ÿæˆå›¾æ ‡åŠŸèƒ½è¯´æ˜

**ä¿¡æ¯èåˆï¼š**
- æå–æ–‡æœ¬/å›¾æ ‡ä¿¡æ¯åŠå…¶åæ ‡
- ç»“åˆè§†è§‰è¯­è¨€æ¨¡å‹ç†è§£å±å¹•å†…å®¹
- ä¸ºå†³ç­–æä¾›ç»“æ„åŒ–çš„ UI ä¿¡æ¯

### 2.2 ç«¯åˆ°ç«¯è§†è§‰ç†è§£ï¼ˆv3/GUI-Owlï¼‰

**ç»Ÿä¸€å¤šæ¨¡æ€å¤„ç†ï¼š**

1. **æ„ŸçŸ¥ï¼ˆPerceptionï¼‰**
   - ç›´æ¥å¤„ç†å±å¹•æˆªå›¾
   - æ— éœ€ç‹¬ç«‹çš„ OCR æˆ–å›¾æ ‡æ£€æµ‹

2. **å®šä½ï¼ˆGroundingï¼‰**
   - ç†è§£ UI å…ƒç´ ä½ç½®å’Œå±‚çº§å…³ç³»
   - æ”¯æŒç²¾ç¡®çš„ç©ºé—´æ¨ç†

3. **æ¨ç†ï¼ˆReasoningï¼‰**
   - ç»“åˆè§†è§‰å’Œä»»åŠ¡ä¸Šä¸‹æ–‡
   - ç”Ÿæˆè¿è´¯çš„æ“ä½œåºåˆ—

**ä¼˜åŠ¿ï¼š**
- å‡å°‘æ„ŸçŸ¥å’Œæ“ä½œé¢‘ç‡
- ç«¯åˆ°ç«¯å­¦ä¹ ï¼Œé¿å…æµæ°´çº¿é”™è¯¯ç´¯ç§¯
- æ”¯æŒè·¨å¹³å°ç»Ÿä¸€å¤„ç†

### 2.3 å±å¹•å¯¹æ¯”æœºåˆ¶ï¼ˆReflectionï¼‰

**å‰åå±å¹•å¯¹æ¯”åˆ†æï¼š**

```
æ“ä½œå‰å±å¹• + æ‰§è¡ŒåŠ¨ä½œ + æ“ä½œåå±å¹• â†’ Reflector Agent
                                          â†“
                          åˆ¤æ–­ï¼šSUCCESS / FAILURE
                                          â†“
                          ç”Ÿæˆå› æœåé¦ˆ
```

**åº”ç”¨åœºæ™¯ï¼š**
- æ£€æµ‹æ“ä½œæ˜¯å¦ç¬¦åˆé¢„æœŸ
- å‘ç°å¼‚å¸¸çŠ¶æ€ï¼ˆå¼¹çª—ã€é”™è¯¯ã€åŠ è½½å¤±è´¥ï¼‰
- æä¾›è¯¦ç»†çš„é”™è¯¯åŸå› åˆ†æ

## 3. ä»»åŠ¡æ‰§è¡Œ

### 3.1 ä»»åŠ¡è§„åˆ’ç­–ç•¥

**v2ï¼šPlanning Agent å†å²æµ“ç¼©**

```
å†—é•¿çš„å†å²æ“ä½œï¼ˆå›¾æ–‡äº¤ç»‡ï¼‰
          â†“
   Planning Agent
          â†“
çº¯æ–‡æœ¬ä»»åŠ¡è¿›åº¦æ‘˜è¦
          â†“
   Decision Agent
```

**ä¼˜åŠ¿ï¼š**
- è§£å†³é•¿ä¸Šä¸‹æ–‡é—®é¢˜
- æå–å…³é”®ä»»åŠ¡çŠ¶æ€
- ä¾¿äº LLM å¯¼èˆªå’Œç†è§£

**v3ï¼šManager Agent åŠ¨æ€åˆ†è§£**

```
é«˜å±‚æŒ‡ä»¤
    â†“
Manager + RAG â†’ å­ç›®æ ‡åˆ—è¡¨ï¼ˆæœ‰åºï¼‰
    â†“
Worker æ‰§è¡Œå­ç›®æ ‡
    â†“
Reflector åé¦ˆ
    â†“
Manager åŠ¨æ€æ›´æ–°è®¡åˆ’
```

**ç‰¹ç‚¹ï¼š**
- åŠ¨æ€è°ƒæ•´ï¼šæ ¹æ®æ‰§è¡Œç»“æœå®æ—¶ä¿®æ”¹è®¡åˆ’
- çŸ¥è¯†å¢å¼ºï¼šRAG æä¾›å¤–éƒ¨çŸ¥è¯†æ”¯æŒ
- åˆ†å±‚ç®¡ç†ï¼šé«˜å±‚è§„åˆ’ + ä½å±‚æ‰§è¡Œåˆ†ç¦»

### 3.2 åŠ¨ä½œæ‰§è¡Œ

**åŸºç¡€åŠ¨ä½œé›†ï¼ˆAndroid Controllerï¼‰ï¼š**

1. **Tapï¼ˆç‚¹å‡»ï¼‰**
   - ç²¾ç¡®åæ ‡ç‚¹å‡»
   - ADB shell input tap x y

2. **Typeï¼ˆè¾“å…¥ï¼‰**
   - æ–‡æœ¬è¾“å…¥
   - å¤„ç†å­—ç¬¦ã€ç©ºæ ¼ã€ç‰¹æ®Šç¬¦å·

3. **Slide/Swipeï¼ˆæ»‘åŠ¨ï¼‰**
   - æ”¯æŒæ–¹å‘æ»‘åŠ¨
   - ADB shell input swipe x1 y1 x2 y2

4. **Navigateï¼ˆå¯¼èˆªï¼‰**
   - Backï¼ˆè¿”å›ï¼‰
   - Homeï¼ˆä¸»å±å¹•ï¼‰

5. **App Openingï¼ˆæ‰“å¼€åº”ç”¨ï¼‰**
   - åº”ç”¨å¯åŠ¨å‘½ä»¤

**æ‰§è¡Œæœºåˆ¶ï¼š**
- åŸºäº ADBï¼ˆAndroid Debug Bridgeï¼‰
- ä½¿ç”¨ subprocess æ‰§è¡Œ shell å‘½ä»¤
- ç›´æ¥è®¾å¤‡äº¤äº’

### 3.3 åŠ¨ä½œé€‰æ‹©ç­–ç•¥

**Worker Agent å†³ç­–æµç¨‹ï¼š**

```
è¾“å…¥ï¼š
- å½“å‰ GUI çŠ¶æ€ï¼ˆå±å¹•æˆªå›¾ï¼‰
- å½“å‰å­ç›®æ ‡
- å…ˆå‰åé¦ˆï¼ˆReflectorï¼‰
- ç´¯ç§¯ç¬”è®°ï¼ˆNotetakerï¼‰

        â†“
   Worker Agent (GUI-Owl)
        â†“

è¾“å‡ºï¼š
- Reasoningï¼ˆæ¨ç†è¿‡ç¨‹ï¼‰
- Actionï¼ˆå…·ä½“åŠ¨ä½œï¼‰
- Intentï¼ˆæ„å›¾è¯´æ˜ï¼‰
```

**å†³ç­–è€ƒè™‘å› ç´ ï¼š**
- æœ€ç›¸å…³çš„å¯æ‰§è¡Œå­ç›®æ ‡
- å†å²æ‰§è¡Œåé¦ˆ
- å…³é”®ä¿¡æ¯ç¬”è®°
- å½“å‰å±å¹•çŠ¶æ€

### 3.4 å¤šæ­¥éª¤ä»»åŠ¡å¤„ç†

**å¾ªç¯æ‰§è¡Œæœºåˆ¶ï¼š**

```
while ä»»åŠ¡æœªå®Œæˆ:
    1. Manager æä¾›å½“å‰å­ç›®æ ‡
    2. Worker æ‰§è¡ŒåŠ¨ä½œ
    3. Reflector è¯„ä¼°ç»“æœ
    4. if SUCCESS:
           Notetaker è®°å½•å…³é”®ä¿¡æ¯
       else:
           Manager æ¥æ”¶åé¦ˆï¼Œè°ƒæ•´è®¡åˆ’
    5. æ›´æ–°ä»»åŠ¡è¿›åº¦
```

**ç‰¹ç‚¹ï¼š**
- æŒç»­ç›‘æ§æ‰§è¡Œç»“æœ
- åŠ¨æ€è°ƒæ•´ç­–ç•¥
- è·¨åº”ç”¨ä¿¡æ¯ä¼ é€’

## 4. è®°å¿†ç®¡ç†

### 4.1 Memory Unitï¼ˆv2ï¼‰

**çŸ­æœŸè®°å¿†æ¨¡å—**

**ç‰¹æ€§ï¼š**
- å­˜å‚¨ä»»åŠ¡ç›¸å…³çš„ç„¦ç‚¹å†…å®¹
- éšä»»åŠ¡è¿›åº¦åŠ¨æ€æ›´æ–°
- åœ¨å¤šåº”ç”¨åœºæ™¯ä¸­è‡³å…³é‡è¦

**æ›´æ–°æœºåˆ¶ï¼š**
- ç”± Decision Agent é©±åŠ¨
- ä¿ç•™å½“å‰ä»»åŠ¡å…³æ³¨çš„é‡è¦ä¿¡æ¯
- é¿å…é—å¿˜å…³é”®ä¸Šä¸‹æ–‡

### 4.2 Notetaker Agentï¼ˆv3ï¼‰

**æŒä¹…åŒ–ä¸Šä¸‹æ–‡è®°å¿†**

**å·¥ä½œæœºåˆ¶ï¼š**

1. **è§¦å‘æ¡ä»¶**ï¼šä»…åœ¨ SUCCESS æ—¶æ¿€æ´»

2. **è®°å½•å†…å®¹**ï¼š
   - å…³é”®å±å¹•å…ƒç´ 
   - éªŒè¯ç 
   - å‡­è¯ä¿¡æ¯
   - ä¸´æ—¶é‡è¦æ•°æ®

3. **ç”¨é€”**ï¼š
   - æ”¯æŒåç»­è§„åˆ’
   - è·¨åº”ç”¨ä¿¡æ¯ä¼ é€’
   - é¿å…é‡å¤æŸ¥æ‰¾

**ç¤ºä¾‹åœºæ™¯ï¼š**
```
ä»»åŠ¡ï¼šé¢„è®¢æœºç¥¨å¹¶å‘é€ç»™æœ‹å‹
1. Worker åœ¨èˆªç­ App æ‰¾åˆ°è®¢å•å· "ABC123"
2. Reflector åˆ¤æ–­ SUCCESS
3. Notetaker è®°å½• "è®¢å•å·: ABC123"
4. Worker åˆ‡æ¢åˆ°æ¶ˆæ¯ App
5. ä» Notes ä¸­è¯»å–è®¢å•å·ï¼Œå‘é€æ¶ˆæ¯
```

### 4.3 ä»»åŠ¡è¿›åº¦ç®¡ç†

**InfoPoolï¼ˆæ¨æµ‹ï¼Œä»£ç ä¸­æåˆ°ï¼‰**

æ ¹æ®ä»£ç åˆ†æï¼Œv3 ä½¿ç”¨ InfoPool è·Ÿè¸ªï¼š
- Action historyï¼ˆåŠ¨ä½œå†å²ï¼‰
- Action outcomesï¼ˆåŠ¨ä½œç»“æœï¼‰
- Error descriptionsï¼ˆé”™è¯¯æè¿°ï¼‰
- Progress statusï¼ˆè¿›åº¦çŠ¶æ€ï¼‰

**ä¼˜åŠ¿ï¼š**
- åŠ¨æ€è·Ÿè¸ªä»»åŠ¡è¿›å±•
- æ”¯æŒå¤šæ­¥éª¤ä»»åŠ¡è°ƒæ•´
- æä¾›å®Œæ•´çš„æ‰§è¡Œä¸Šä¸‹æ–‡

### 4.4 å†å²æ“ä½œå‹ç¼©

**Planning Agent çš„å†å²æµ“ç¼©ï¼ˆv2ï¼‰**

**å‹ç¼©ç­–ç•¥ï¼š**
- å°†å†—é•¿çš„å›¾æ–‡äº¤ç»‡å†å²æ“ä½œ
- æµ“ç¼©ä¸ºçº¯æ–‡æœ¬ä»»åŠ¡è¿›åº¦
- å‡å°‘ token æ¶ˆè€—

**æ•ˆæœï¼š**
- æ˜¾è‘—å‡å°‘ä¸Šä¸‹æ–‡é•¿åº¦
- ä¿ç•™å…³é”®ä»»åŠ¡çŠ¶æ€
- æå‡ LLM å¯¼èˆªæ•ˆç‡

## 5. é”™è¯¯å¤„ç†

### 5.1 Reflection Agent é”™è¯¯æ£€æµ‹ï¼ˆv2/v3ï¼‰

**ä¸‰å±‚é”™è¯¯åˆ†ç±»ï¼š**

1. **Erroneous Operationsï¼ˆé”™è¯¯æ“ä½œï¼‰**
   - æ˜ç¡®çš„é”™è¯¯åŠ¨ä½œ
   - å¯¼è‡´ä»»åŠ¡å¤±è´¥

2. **Ineffective Operationsï¼ˆæ— æ•ˆæ“ä½œï¼‰**
   - æ²¡æœ‰äº§ç”Ÿé¢„æœŸæ•ˆæœ
   - éœ€è¦é‡è¯•æˆ–è°ƒæ•´

3. **Correct Operationsï¼ˆæ­£ç¡®æ“ä½œï¼‰**
   - ç¬¦åˆé¢„æœŸ
   - ç»§ç»­ä¸‹ä¸€æ­¥

**æ£€æµ‹æ–¹æ³•ï¼š**
- å¯¹æ¯”æ“ä½œå‰åå±å¹•
- åˆ†æçŠ¶æ€è½¬æ¢
- ç”Ÿæˆè¯¦ç»†åé¦ˆ

### 5.2 é”™è¯¯æ¢å¤æœºåˆ¶

**v2 æ¢å¤ç­–ç•¥ï¼š**

1. **Reflection Flag**
   - å¯é€‰çš„é”™è¯¯æ ‡è®°
   - è·Ÿè¸ªé—®é¢˜äº¤äº’

2. **Fallback Actions**
   - è¿”å›ä¸»å±å¹•
   - å›åˆ°ä¸Šä¸€çŠ¶æ€

3. **Reflection åé¦ˆ**
   - Decision Agent æ¥æ”¶åæ€ç»“æœ
   - åŸºäºåæ€è°ƒæ•´ä¸‹ä¸€æ­¥åŠ¨ä½œ

**v3 æ¢å¤ç­–ç•¥ï¼š**

1. **é”™è¯¯é˜ˆå€¼æœºåˆ¶**
   - è®¾ç½®æœ€å¤§é”™è¯¯æ¬¡æ•°
   - è¶…è¿‡é˜ˆå€¼è§¦å‘ç‰¹æ®Šå¤„ç†

2. **è‡ªåŠ¨é‡è¯•å’Œå›é€€**
   - Reflector åˆ¤æ–­ FAILURE
   - Manager æ¥æ”¶åé¦ˆ
   - è°ƒæ•´è®¡åˆ’æˆ–é‡è¯•

3. **è¯¦ç»†é”™è¯¯æ—¥å¿—**
   - InfoPool è®°å½•é”™è¯¯æè¿°
   - æ”¯æŒè°ƒè¯•å’Œåˆ†æ

4. **è·³è¿‡ Manager é‡è¯•**
   - å½“æ”¶åˆ°æ— æ•ˆå“åº”æ—¶
   - ç›´æ¥é‡è¯•åŠ¨ä½œè€Œä¸é‡æ–°è§„åˆ’

### 5.3 å¼‚å¸¸åœºæ™¯å¤„ç†

**å¸¸è§å¼‚å¸¸ï¼š**

1. **å¼¹çª—å¤„ç†**
   - Reflector æ£€æµ‹åˆ°æ„å¤–å¼¹çª—
   - åé¦ˆç»™ Manager/Decision Agent
   - è°ƒæ•´æ“ä½œç­–ç•¥

2. **åŠ è½½è¶…æ—¶**
   - å±å¹•çŠ¶æ€æœªå˜åŒ–
   - åˆ¤æ–­ä¸º Ineffective
   - é‡è¯•æˆ–è°ƒæ•´

3. **åº”ç”¨å´©æºƒ**
   - æ£€æµ‹åˆ°å¼‚å¸¸çŠ¶æ€
   - å›é€€åˆ°å®‰å…¨çŠ¶æ€
   - é‡æ–°å¼€å§‹ä»»åŠ¡

4. **æƒé™è¯·æ±‚**
   - è¯†åˆ«æƒé™å¯¹è¯æ¡†
   - æ‰§è¡Œç›¸åº”æ“ä½œï¼ˆå…è®¸/æ‹’ç»ï¼‰

## 6. å…³é”®äº®ç‚¹

### 6.1 æ¶æ„åˆ›æ–°

**1. å¤š Agent åä½œèŒƒå¼**

- **v2 åˆ›æ–°**ï¼šé¦–æ¬¡å°† Planningã€Decisionã€Reflection åˆ†ç¦»
- **v3 åˆ›æ–°**ï¼šè¿›ä¸€æ­¥ç»†åŒ–ä¸º Managerã€Workerã€Reflectorã€Notetaker
- **ä¼˜åŠ¿**ï¼š
  - å„ Agent ä¸“æ³¨æ ¸å¿ƒèŒè´£
  - é™ä½å•ä¸€ Agent å¤æ‚åº¦
  - æå‡ç³»ç»Ÿå¯ç»´æŠ¤æ€§

**2. ç«¯åˆ°ç«¯ + å¤š Agent åŒå±‚æ¶æ„**

```
åº”ç”¨å±‚ï¼šå¤š Agent åä½œï¼ˆè§„åˆ’ã€æ‰§è¡Œã€åæ€ã€è®°å½•ï¼‰
         â†“
åŸºç¡€å±‚ï¼šGUI-Owl ç«¯åˆ°ç«¯æ¨¡å‹ï¼ˆæ„ŸçŸ¥ã€å®šä½ã€æ¨ç†ã€æ‰§è¡Œï¼‰
```

- **çµæ´»æ€§**ï¼šGUI-Owl å¯ç‹¬ç«‹ä½¿ç”¨æˆ–ä½œä¸ºç»„ä»¶
- **æ€§èƒ½**ï¼šç«¯åˆ°ç«¯å‡å°‘æµæ°´çº¿è¯¯å·®
- **å¯æ‰©å±•æ€§**ï¼šå¤š Agent æ˜“äºæ·»åŠ æ–°èƒ½åŠ›

**3. åŠ¨æ€ä»»åŠ¡åˆ†è§£**

- éé™æ€è§„åˆ’ï¼šæ ¹æ®æ‰§è¡Œç»“æœå®æ—¶è°ƒæ•´
- çŸ¥è¯†å¢å¼ºï¼šRAG æä¾›å¤–éƒ¨çŸ¥è¯†
- é€‚åº”æ€§å¼ºï¼šå¤„ç†å¤æ‚é•¿å‘¨æœŸä»»åŠ¡

### 6.2 æ€§èƒ½ä¼˜åŒ–æŠ€å·§

**1. ä¸Šä¸‹æ–‡ä¼˜åŒ–**

- **å†å²æµ“ç¼©**ï¼ˆv2ï¼‰ï¼šPlanning Agent å°†å›¾æ–‡å†å²å‹ç¼©ä¸ºçº¯æ–‡æœ¬
- **å‡å°‘æ„ŸçŸ¥é¢‘ç‡**ï¼ˆv3ï¼‰ï¼šç«¯åˆ°ç«¯æ¨¡å‹é™ä½ OCR/å›¾æ ‡æ£€æµ‹éœ€æ±‚
- **æ•ˆæœ**ï¼šæ˜¾è‘—å‡å°‘ token æ¶ˆè€—ï¼Œæå‡æ¨ç†é€Ÿåº¦

**2. æ¨¡å—åŒ–æç¤ºå·¥ç¨‹**

- æ¯ä¸ª Agent æœ‰ä¸“é—¨çš„ Prompt æ¨¡æ¿
- æ˜ç¡®çš„åŠ¨ä½œ/æ€è€ƒæŒ‡å—
- ä¸Šä¸‹æ–‡ä¸°å¯Œçš„æç¤ºç»“æ„

**3. å¼‚æ­¥å¹¶å‘ï¼ˆæ¨æµ‹ï¼‰**

- GUI-Owl ä½¿ç”¨å…¨å¼‚æ­¥è®­ç»ƒæ¡†æ¶
- æ”¯æŒå¤§è§„æ¨¡å¹¶å‘ç¯å¢ƒäº¤äº’
- æå‡è®­ç»ƒå’Œæ¨ç†æ•ˆç‡

**4. è§†è§‰æ„ŸçŸ¥å¢å¼º**

- **v2**ï¼šä¸‰å·¥å…·ååŒï¼ˆOCR + Icon Detection + Captionï¼‰
- **v3**ï¼šç«¯åˆ°ç«¯ç»Ÿä¸€å¤„ç†
- **ç»“æœ**ï¼šæå‡æ“ä½œç²¾åº¦

### 6.3 æŠ€æœ¯åˆ›æ–°ç‚¹

**1. è‡ªæ¼”åŒ–è½¨è¿¹ç”Ÿæˆ**

- å¤§è§„æ¨¡äº‘ç«¯è™šæ‹Ÿç¯å¢ƒ
- Self-Evolving GUI Trajectory Production
- æ”¯æŒæŒç»­å­¦ä¹ å’Œæ”¹è¿›

**2. TRPOï¼ˆTrajectory-aware Relative Policy Optimizationï¼‰**

- ä¸“ä¸º GUI è‡ªåŠ¨åŒ–è®¾è®¡çš„å¼ºåŒ–å­¦ä¹ ç®—æ³•
- åœ¨çº¿ RL æ¡†æ¶
- å®ç°çœŸå®ä¸–ç•Œå¯¹é½

**3. æŒä¹…åŒ–è®°å¿†æœºåˆ¶ï¼ˆNotetakerï¼‰**

- åˆ›æ–°ç‚¹ï¼šä»…åœ¨æˆåŠŸæ—¶è®°å½•
- é¿å…å™ªéŸ³ä¿¡æ¯
- æ”¯æŒè·¨åº”ç”¨ä¿¡æ¯ä¼ é€’

**4. å› æœåé¦ˆç”Ÿæˆ**

- Reflector ä¸ä»…åˆ¤æ–­æˆåŠŸ/å¤±è´¥
- ç”Ÿæˆè¯¦ç»†çš„å› æœåˆ†æ
- å¸®åŠ© Manager ç†è§£å¤±è´¥åŸå› 

**5. è·¨å¹³å°ç»Ÿä¸€æ¡†æ¶**

- é¦–ä¸ªæ”¯æŒ Androidã€PCã€macOSã€Windows çš„ç»¼åˆ GUI Agent
- ç»Ÿä¸€æ¥å£å’Œæ•°æ®æ¨¡å‹
- å‡å°‘å¹³å°ç‰¹å®šä»£ç 

### 6.4 æœ€ä½³å®è·µ

**1. Agent èŒè´£åˆ†ç¦»**

```
è§„åˆ’ï¼ˆManagerï¼‰ | æ‰§è¡Œï¼ˆWorkerï¼‰ | è¯„ä¼°ï¼ˆReflectorï¼‰ | è®°å½•ï¼ˆNotetakerï¼‰
      â†“                â†“                  â†“                   â†“
   æˆ˜ç•¥å±‚           æˆ˜æœ¯å±‚              è´¨é‡å±‚              è®°å¿†å±‚
```

**2. åé¦ˆé©±åŠ¨çš„åŠ¨æ€è°ƒæ•´**

- æ¯æ¬¡æ“ä½œåç«‹å³è¯„ä¼°
- æ ¹æ®åé¦ˆè°ƒæ•´åç»­è®¡åˆ’
- å½¢æˆé—­ç¯ä¼˜åŒ–

**3. å¤–éƒ¨çŸ¥è¯†å¢å¼º**

- RAG æ¨¡å—æä¾›ä¸–ç•ŒçŸ¥è¯†
- å¼¥è¡¥æ¨¡å‹çŸ¥è¯†å±€é™
- æå‡å¤æ‚ä»»åŠ¡å¤„ç†èƒ½åŠ›

**4. æ¸è¿›å¼é”™è¯¯å¤„ç†**

- ç¬¬ä¸€å±‚ï¼šReflector æ£€æµ‹é”™è¯¯
- ç¬¬äºŒå±‚ï¼šManager è°ƒæ•´è®¡åˆ’
- ç¬¬ä¸‰å±‚ï¼šé”™è¯¯é˜ˆå€¼ä¿æŠ¤

**5. å¤šæ¨¡æ€èåˆ**

- å±å¹•æˆªå›¾ + UI æ ‘ + æ–‡æœ¬æå–
- è§†è§‰ + è¯­è¨€åŒé‡ç†è§£
- æå‡é²æ£’æ€§

### 6.5 æ•°æ®æ¨¡å‹è®¾è®¡

**Pydantic ä¸¥æ ¼ç±»å‹æ£€æŸ¥ï¼š**

1. **æ¶ˆæ¯æ¨¡å‹**
   - æ”¯æŒå¤šæ¨¡æ€å†…å®¹ï¼ˆæ–‡æœ¬ã€å›¾åƒã€æ–‡ä»¶ã€éŸ³é¢‘ã€è§†é¢‘ï¼‰
   - ä¸åŒè§’è‰²ï¼ˆsystemã€userã€assistantã€functionï¼‰
   - å¯é€‰çš„æ¨ç†å†…å®¹ã€å‡½æ•°è°ƒç”¨ã€å…ƒæ•°æ®

2. **åŠ¨ä½œæ¨¡å‹**
   - ç»“æ„åŒ–åŠ¨ä½œå®šä¹‰
   - åŒ…å«æ¨ç†ã€åŠ¨ä½œã€æ„å›¾

3. **éªŒè¯å™¨**
   - ç¡®ä¿æ•°æ®å®Œæ•´æ€§
   - å†…ç½®éªŒè¯é€»è¾‘

**ä¼˜åŠ¿ï¼š**
- å¼ºç±»å‹å®‰å…¨
- æ˜“äºåºåˆ—åŒ–/ååºåˆ—åŒ–
- æ”¯æŒå¤æ‚é€šä¿¡åœºæ™¯

### 6.6 ä¸ droidrun-vl é¡¹ç›®çš„å¯¹æ¯”

| ç»´åº¦ | MobileAgent | droidrun-vlï¼ˆè§„åˆ’ï¼‰ |
|------|-------------|---------------------|
| **Agent æ¶æ„** | v3: 4 ä¸ªä¸“ä¸š Agentï¼ˆManager/Worker/Reflector/Notetakerï¼‰ | åŒå±‚æ¶æ„ï¼ˆMaster/Workerï¼‰ |
| **ä»»åŠ¡åˆ†è§£** | Manager Agent åŠ¨æ€åˆ†è§£ + RAG | Master Agent åˆ†è§£ + è°ƒåº¦ |
| **æ‰§è¡Œ** | Worker Agentï¼ˆåŸºäº GUI-Owlï¼‰ | Worker Agentï¼ˆè®¤çŸ¥å¾ªç¯ï¼‰ |
| **åæ€** | ç‹¬ç«‹ Reflector Agentï¼ŒSUCCESS/FAILURE + å› æœåé¦ˆ | å…ƒè®¤çŸ¥ + è¯•é”™æœºåˆ¶ + å³æ—¶åé¦ˆ |
| **è®°å¿†** | Notetakerï¼ˆä»… SUCCESS è§¦å‘ï¼‰+ Memory Unit | å·¥ä½œè®°å¿†ï¼ˆ7Â±2ï¼‰+ é•¿æœŸè®°å¿†ï¼ˆLanceDBï¼‰ |
| **è§†è§‰ç†è§£** | GUI-Owl ç«¯åˆ°ç«¯ OR ä¸‰å·¥å…·ï¼ˆOCR/Icon/Captionï¼‰ | å¹¶å‘æ„ŸçŸ¥ï¼ˆ0.5s åå°è§‚å¯Ÿï¼‰ |
| **é”™è¯¯æ¢å¤** | é”™è¯¯é˜ˆå€¼ + è‡ªåŠ¨é‡è¯• + è¯¦ç»†æ—¥å¿— | å¼‚å¸¸æ£€æµ‹ + æ¢å¤æœºåˆ¶ + è¯•é”™çº é”™ |
| **æ€§èƒ½ç‰¹ç‚¹** | åŠ¨æ€è§„åˆ’ï¼Œè·¨å¹³å°ç»Ÿä¸€ | å¹¶å‘ä¼˜åŒ–ï¼Œäººç±»è®¤çŸ¥æ¨¡æ‹Ÿ |

## 7. å¯å€Ÿé‰´çš„ç»éªŒ

### 7.1 ç«‹å³å¯ç”¨çš„ç»éªŒ

**1. å¤š Agent èŒè´£åˆ†ç¦»**

```python
# å€Ÿé‰´ MobileAgent çš„ 4 Agent åˆ†å·¥
# droidrun-vl å¯ä»¥è€ƒè™‘ï¼š

class MasterAgent:
    """ä»»åŠ¡ç®¡ç† + è§„åˆ’ï¼ˆç±»ä¼¼ Managerï¼‰"""
    def decompose_task(self, instruction): ...
    def update_plan(self, feedback): ...

class WorkerAgent:
    """æ‰§è¡Œï¼ˆç±»ä¼¼ Workerï¼‰"""
    def observe_screen(self): ...
    def decide_action(self): ...
    def execute_action(self): ...

class MetacognitionAgent:
    """å…ƒè®¤çŸ¥ + åæ€ï¼ˆç±»ä¼¼ Reflectorï¼‰"""
    def evaluate_result(self, before, after, action): ...
    def generate_feedback(self): ...

class MemoryAgent:
    """è®°å¿†ç®¡ç†ï¼ˆç±»ä¼¼ Notetakerï¼‰"""
    def record_success(self, key_info): ...
    def retrieve_context(self): ...
```

**2. ä»…åœ¨æˆåŠŸæ—¶è®°å½•ï¼ˆNotetaker ç­–ç•¥ï¼‰**

```python
# é¿å…å™ªéŸ³ä¿¡æ¯æ±¡æŸ“è®°å¿†
if result.status == "SUCCESS":
    key_info = extract_critical_elements(screen, action)
    memory_agent.record(key_info)
```

**3. å‰åå±å¹•å¯¹æ¯”ï¼ˆReflector æœºåˆ¶ï¼‰**

```python
# å³æ—¶åé¦ˆçš„å¢å¼ºç‰ˆ
async def execute_with_reflection(action):
    before_screen = await capture_screen()
    result = await execute_action(action)
    await asyncio.sleep(0.5)  # ç­‰å¾…çŠ¶æ€ç¨³å®š
    after_screen = await capture_screen()

    feedback = reflector.compare(before_screen, after_screen, action.intent)
    return result, feedback
```

**4. åŠ¨æ€ä»»åŠ¡åˆ†è§£**

```python
# ä¸æ˜¯ä¸€æ¬¡æ€§è§„åˆ’ï¼Œè€Œæ˜¯æ ¹æ®åé¦ˆåŠ¨æ€è°ƒæ•´
class MasterAgent:
    async def manage_task(self, instruction):
        plan = await self.initial_planning(instruction)

        while not task_completed:
            current_goal = plan.get_current_goal()
            result, feedback = await worker.execute(current_goal)

            if feedback.status == "FAILURE":
                plan = await self.replan(plan, feedback)
            else:
                plan.mark_completed(current_goal)
```

**5. é”™è¯¯é˜ˆå€¼ä¿æŠ¤**

```python
# é¿å…æ— é™å¾ªç¯
class ExecutionController:
    def __init__(self, max_errors=5):
        self.error_count = 0
        self.max_errors = max_errors

    async def execute_with_protection(self, action):
        result = await execute(action)

        if result.status == "FAILURE":
            self.error_count += 1
            if self.error_count >= self.max_errors:
                raise MaxErrorsExceeded("è¶…è¿‡æœ€å¤§é”™è¯¯æ¬¡æ•°")
        else:
            self.error_count = 0  # æˆåŠŸåé‡ç½®
```

### 7.2 æ¶æ„è®¾è®¡å±‚é¢

**1. åŒå±‚æ¶æ„ï¼šåŸºç¡€æ¨¡å‹ + å¤š Agent**

- **åŸºç¡€å±‚**ï¼šè§†è§‰ç†è§£ + åŠ¨ä½œç”Ÿæˆï¼ˆç±»ä¼¼ GUI-Owlï¼‰
- **åº”ç”¨å±‚**ï¼šä»»åŠ¡ç®¡ç† + åä½œï¼ˆå¤š Agentï¼‰

**2. æ¨¡å—åŒ– Prompt ç®¡ç†**

```python
# æ¯ä¸ª Agent ç‹¬ç«‹çš„ Prompt æ¨¡æ¿
MANAGER_PROMPT = """
ä½ æ˜¯ä»»åŠ¡ç®¡ç† Agentï¼Œè´Ÿè´£åˆ†è§£ä»»åŠ¡å’ŒåŠ¨æ€è§„åˆ’ã€‚
å½“å‰ä»»åŠ¡ï¼š{instruction}
æ‰§è¡Œå†å²ï¼š{history}
åé¦ˆï¼š{feedback}
è¯·æ›´æ–°ä»»åŠ¡è®¡åˆ’...
"""

WORKER_PROMPT = """
ä½ æ˜¯æ‰§è¡Œ Agentï¼Œè´Ÿè´£å…·ä½“æ“ä½œã€‚
å½“å‰ç›®æ ‡ï¼š{current_goal}
å±å¹•çŠ¶æ€ï¼š{screen_analysis}
å…³é”®ç¬”è®°ï¼š{notes}
è¯·é€‰æ‹©æœ€ä½³åŠ¨ä½œ...
"""
```

**3. ä¿¡æ¯æ± ï¼ˆInfoPoolï¼‰è®¾è®¡**

```python
class InfoPool:
    """é›†ä¸­ç®¡ç†æ‰§è¡Œä¿¡æ¯"""
    def __init__(self):
        self.action_history = []
        self.action_outcomes = []
        self.error_descriptions = []
        self.progress_status = {}
        self.key_notes = {}

    def add_action(self, action, outcome, feedback):
        self.action_history.append(action)
        self.action_outcomes.append(outcome)
        if outcome == "FAILURE":
            self.error_descriptions.append(feedback)
```

### 7.3 æ€§èƒ½ä¼˜åŒ–å±‚é¢

**1. å†å²å‹ç¼©ç­–ç•¥**

```python
# é¿å…ä¸Šä¸‹æ–‡è¿‡é•¿
def compress_history(history: List[Action]) -> str:
    """å°†è¯¦ç»†å†å²å‹ç¼©ä¸ºä»»åŠ¡è¿›åº¦æ‘˜è¦"""
    # æå–å…³é”®çŠ¶æ€è½¬æ¢
    # å¿½ç•¥ä¸­é—´ç»†èŠ‚
    # è¿”å›çº¯æ–‡æœ¬æ‘˜è¦
    return task_progress_summary
```

**2. å‡å°‘æ„ŸçŸ¥é¢‘ç‡**

- ä¸æ˜¯æ¯æ¬¡éƒ½å®Œæ•´åˆ†æå±å¹•
- ä»…åœ¨éœ€è¦æ—¶è¿›è¡Œè¯¦ç»† OCR/å›¾æ ‡æ£€æµ‹
- ä½¿ç”¨ç¼“å­˜é¿å…é‡å¤åˆ†æ

**3. å¼‚æ­¥å¹¶å‘**

```python
# droidrun-vl å·²æœ‰çš„å¹¶å‘æ„ŸçŸ¥æœºåˆ¶å¯ä»¥è¿›ä¸€æ­¥å¢å¼º
async def concurrent_perception():
    # åŒæ—¶æ‰§è¡Œå¤šä¸ªæ„ŸçŸ¥ä»»åŠ¡
    ocr_task = asyncio.create_task(ocr_analysis())
    ui_task = asyncio.create_task(ui_tree_analysis())
    vision_task = asyncio.create_task(vision_analysis())

    ocr, ui, vision = await asyncio.gather(ocr_task, ui_task, vision_task)
    return fuse_results(ocr, ui, vision)
```

### 7.4 æ•°æ®æ¨¡å‹å±‚é¢

**1. Pydantic ä¸¥æ ¼ç±»å‹**

```python
from pydantic import BaseModel, Field
from typing import Literal, Optional, List

class ActionResult(BaseModel):
    status: Literal["SUCCESS", "FAILURE", "INEFFECTIVE"]
    reasoning: str
    action: str
    intent: str
    feedback: Optional[str] = None

class TaskPlan(BaseModel):
    instruction: str
    subgoals: List[str]
    completed: List[int] = Field(default_factory=list)
    current_index: int = 0
```

**2. å¤šæ¨¡æ€å†…å®¹ç»“æ„**

```python
class MultiModalContent(BaseModel):
    text: Optional[str] = None
    image: Optional[str] = None  # Base64 or path
    metadata: dict = Field(default_factory=dict)
```

### 7.5 é¿å…çš„å‘

**1. ä¸è¦åœ¨å¤±è´¥æ—¶è®°å½•**

- MobileAgent Notetaker ä»…åœ¨ SUCCESS è§¦å‘
- é¿å…é”™è¯¯ä¿¡æ¯æ±¡æŸ“è®°å¿†

**2. ä¸è¦é™æ€è§„åˆ’**

- åŠ¨æ€è°ƒæ•´è®¡åˆ’æ¯”ä¸€æ¬¡æ€§è§„åˆ’æ›´é²æ£’
- æ ¹æ®åé¦ˆå®æ—¶ä¿®æ­£

**3. ä¸è¦å¿½ç•¥æ— æ•ˆæ“ä½œ**

- Ineffective å’Œ Erroneous éƒ½éœ€è¦å¤„ç†
- æ— æ•ˆæ“ä½œä¹Ÿå¯èƒ½å¯¼è‡´ä»»åŠ¡å¤±è´¥

**4. ä¸è¦è¿‡åº¦å‹ç¼©ä¸Šä¸‹æ–‡**

- ä¿ç•™è¶³å¤Ÿä¿¡æ¯ä¾› LLM ç†è§£
- å¹³è¡¡å‹ç¼©ç‡å’Œä¿¡æ¯å®Œæ•´æ€§

### 7.6 droidrun-vl çš„ä¼˜åŠ¿ä¿ç•™

**1. å¹¶å‘æ„ŸçŸ¥ï¼ˆ0.5s åå°è§‚å¯Ÿï¼‰**

- MobileAgent æ²¡æœ‰æ˜ç¡®æåˆ°æŒç»­è§‚å¯Ÿ
- droidrun-vl çš„å¹¶å‘æ„ŸçŸ¥æ˜¯ç‹¬ç‰¹ä¼˜åŠ¿
- å¯ä»¥ä¸ Reflector æœºåˆ¶ç»“åˆ

**2. äººç±»è®¤çŸ¥æ¨¡æ‹Ÿ**

- å·¥ä½œè®°å¿† 7Â±2 å®¹é‡
- æ—¶é—´è¡°å‡æœºåˆ¶
- è§‚å¯Ÿ â†’ æ€è€ƒ â†’ å†³ç­– â†’ æ‰§è¡Œ â†’ åé¦ˆå¾ªç¯

**3. ç©ºé—´è®°å¿†ï¼ˆé¡µé¢å¯¼èˆªå›¾ï¼‰**

- MobileAgent æ²¡æœ‰æ˜ç¡®çš„ç©ºé—´è®°å¿†
- droidrun-vl è§„åˆ’çš„ç©ºé—´è®°å¿†å¯ä»¥è¡¥å…… Notetaker

**4. å‘é‡æ£€ç´¢ï¼ˆLanceDBï¼‰**

- ç»éªŒå¤ç”¨ï¼Œé¦–æ¬¡æ¢ç´¢åç»­ç›´è¾¾
- MobileAgent ä½¿ç”¨ RAGï¼Œä½†æœªæ˜ç¡®å‘é‡åº“å®ç°

### 7.7 èåˆå»ºè®®

**æœ€ä½³å®è·µç»„åˆï¼š**

```
droidrun-vl æ ¸å¿ƒ + MobileAgent ç»éªŒ

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Master Agentï¼ˆä»»åŠ¡ç®¡ç†ï¼‰         â”‚
â”‚  - åŠ¨æ€ä»»åŠ¡åˆ†è§£ï¼ˆå€Ÿé‰´ Managerï¼‰          â”‚
â”‚  - RAG å¤–éƒ¨çŸ¥è¯†ï¼ˆå€Ÿé‰´ v3ï¼‰              â”‚
â”‚  - å¾ªç¯ä»»åŠ¡ç®¡ç†ï¼ˆä¿ç•™ï¼‰                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Worker Agentï¼ˆè®¤çŸ¥æ‰§è¡Œï¼‰         â”‚
â”‚  - å¹¶å‘æ„ŸçŸ¥ï¼ˆä¿ç•™ï¼Œ0.5s åå°ï¼‰          â”‚
â”‚  - CoT + å…ƒè®¤çŸ¥å†³ç­–ï¼ˆä¿ç•™ï¼‰             â”‚
â”‚  - å³æ—¶åé¦ˆï¼ˆä¿ç•™ + Reflector å¢å¼ºï¼‰    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Metacognition/Reflectorï¼ˆåæ€å±‚ï¼‰    â”‚
â”‚  - å‰åå±å¹•å¯¹æ¯”ï¼ˆå€Ÿé‰´ Reflectorï¼‰       â”‚
â”‚  - SUCCESS/FAILURE/INEFFECTIVE åˆ†ç±»     â”‚
â”‚  - å› æœåé¦ˆç”Ÿæˆï¼ˆå€Ÿé‰´ v3ï¼‰              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       Memory Managerï¼ˆè®°å¿†å±‚ï¼‰          â”‚
â”‚  - å·¥ä½œè®°å¿† 7Â±2ï¼ˆä¿ç•™ï¼‰                 â”‚
â”‚  - é•¿æœŸè®°å¿†å‘é‡åº“ï¼ˆä¿ç•™ï¼‰                â”‚
â”‚  - Notetaker æœºåˆ¶ï¼ˆå€Ÿé‰´ï¼Œä»… SUCCESSï¼‰   â”‚
â”‚  - ç©ºé—´è®°å¿†å¯¼èˆªå›¾ï¼ˆä¿ç•™ï¼‰                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 8. æ€»ç»“

MobileAgent é¡¹ç›®ç»å†ä¸‰ä»£æ¼”è¿›ï¼Œä»å• Agent åˆ°å¤š Agent åä½œï¼Œå†åˆ°ç«¯åˆ°ç«¯æ¨¡å‹ + å¤š Agent åŒå±‚æ¶æ„ï¼Œå±•ç°äº† GUI è‡ªåŠ¨åŒ–é¢†åŸŸçš„å‰æ²¿æ¢ç´¢ã€‚

**æ ¸å¿ƒä»·å€¼ï¼š**

1. **å¤š Agent åä½œèŒƒå¼**ï¼šå°†è§„åˆ’ã€æ‰§è¡Œã€åæ€ã€è®°å½•åˆ†ç¦»ï¼Œå„å¸å…¶èŒ
2. **åŠ¨æ€ä»»åŠ¡åˆ†è§£**ï¼šæ ¹æ®åé¦ˆå®æ—¶è°ƒæ•´è®¡åˆ’ï¼Œé€‚åº”å¤æ‚åœºæ™¯
3. **æŒä¹…åŒ–è®°å¿†**ï¼šNotetaker ä»…åœ¨æˆåŠŸæ—¶è®°å½•ï¼Œæ”¯æŒè·¨åº”ç”¨ä¿¡æ¯ä¼ é€’
4. **å› æœåé¦ˆ**ï¼šReflector ä¸ä»…åˆ¤æ–­å¯¹é”™ï¼Œè¿˜ç”Ÿæˆè¯¦ç»†åŸå› 
5. **ç«¯åˆ°ç«¯ç»Ÿä¸€**ï¼šGUI-Owl å‡å°‘æµæ°´çº¿è¯¯å·®ï¼Œæå‡æ€§èƒ½

**å¯¹ droidrun-vl çš„å¯ç¤ºï¼š**

- ä¿ç•™å¹¶å‘æ„ŸçŸ¥ã€äººç±»è®¤çŸ¥æ¨¡æ‹Ÿã€ç©ºé—´è®°å¿†ç­‰ä¼˜åŠ¿
- å€Ÿé‰´åŠ¨æ€è§„åˆ’ã€Reflector æœºåˆ¶ã€Notetaker ç­–ç•¥
- èåˆåŒæ–¹ä¼˜åŠ¿ï¼Œæ‰“é€ æ›´å¼ºå¤§çš„ç§»åŠ¨ Agent ç³»ç»Ÿ

**æ€§èƒ½å¯¹æ¯”ï¼š**

- Mobile-Agent-v2: 30%+ æå‡ï¼ˆç›¸æ¯” v1ï¼‰
- Mobile-Agent-v3: AndroidWorld 62.1%ï¼ŒOSWorld 48.4%ï¼ˆSOTAï¼‰
- droidrun-vl: å¹¶å‘æ„ŸçŸ¥ 3 å€é€Ÿåº¦æå‡ï¼ˆ0.5s vs 1.5sï¼‰

ä¸¤ä¸ªé¡¹ç›®çš„èåˆå¯èƒ½åˆ›é€ æ›´ä¼˜ç§€çš„ç§»åŠ¨ Agent è§£å†³æ–¹æ¡ˆã€‚
